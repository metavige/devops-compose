# DevOps Compose è‡ªå‹•ç’°å¢ƒè¨­å®š
# ä½¿ç”¨ direnv è‡ªå‹•è¼‰å…¥ç’°å¢ƒè®Šæ•¸å’Œå•Ÿå‹•æ ¸å¿ƒæœå‹™
#
# å®‰è£ direnv: brew install direnv
# è¨­å®š shell: eval "$(direnv hook bash)" åŠ å…¥ ~/.bashrc
# å…è¨±æ­¤ç›®éŒ„: direnv allow

# è¼‰å…¥ç’°å¢ƒè®Šæ•¸
if [ -f .env ]; then
    dotenv .env
fi

# è¨­å®šè·¯å¾‘
PATH_add scripts

# æª¢æŸ¥æ ¸å¿ƒæœå‹™ç‹€æ…‹
check_core_services() {
    if ! docker compose -f core/docker-compose.yml ps --quiet | grep -q .; then
        echo "ğŸš€ æ ¸å¿ƒæœå‹™æœªé‹è¡Œï¼Œä½¿ç”¨ './scripts/start-core.sh' å•Ÿå‹•"
        return 1
    fi
    return 0
}

# é¡¯ç¤ºæ­¡è¿è¨Šæ¯
welcome_message() {
    echo "ğŸ‰ æ­¡è¿ä½¿ç”¨ DevOps Compose!"
    echo ""
    echo "ğŸ“‹ å¯ç”¨æŒ‡ä»¤:"
    echo "  â€¢ åˆå§‹åŒ–ç’°å¢ƒ:     ./init.sh"
    echo "  â€¢ å•Ÿå‹•æ ¸å¿ƒæœå‹™:   start-core.sh"
    echo "  â€¢ åœæ­¢æ ¸å¿ƒæœå‹™:   stop-core.sh"
    echo "  â€¢ å•Ÿå‹•æœå‹™:       make start service=<service>"
    echo "  â€¢ æˆ–ä½¿ç”¨ Task:     task start:<service>"
    echo ""
    echo "ğŸŒ æœå‹™é€£çµ (éœ€å…ˆå•Ÿå‹•æ ¸å¿ƒæœå‹™):"
    echo "  â€¢ Traefik:  https://traefik.docker.internal"
    echo "  â€¢ Registry: https://registry.docker.internal"
    echo "  â€¢ Whoami:   https://whoami.docker.internal"
    echo ""
}

welcome_message

# å¦‚æœæ ¸å¿ƒæœå‹™æœªé‹è¡Œï¼Œæç¤ºç”¨æˆ¶
if ! check_core_services; then
    echo "ğŸ’¡ æç¤º: å¤§å¤šæ•¸æœå‹™éœ€è¦æ ¸å¿ƒæœå‹™é‹è¡Œæ‰èƒ½æ­£å¸¸å·¥ä½œ"
fi